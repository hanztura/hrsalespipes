{% extends "dashboard/base.html" %}
{% load static %}

{% block title %}
Dashboard
{% endblock title %}


{% block subcontent %}
  <input type="hidden" id="dataDashboardItemsNumber" value="{{ dashboard_items_number }}">
  <input type="hidden" id="dataSuccessfulJobsAllTimePerIndustry" value="{{ sjatpi }}">
  <v-container
    fluid>
    <h1>Dashboard</h1>
    <v-row
      align="center"
      justify="center"
    >
      <dashboard-value-card
        v-for="item in dashboardItemsNumber"
        :key="item.title"
        :text="item.title"
        :value="item.value"></dashboard-value-card>
    </v-row>
    <v-row
      align="center"
      justify="center"
    >
      <v-col cols=12 md=6>
        <v-card
          class="mx-auto text-center"
          color="primary"
          dark>
          <v-card-text>
            <div class="display-1 font-weight-thin">Successful jobs per industry</div>
          </v-card-text>

          <v-card-text>
            <v-sheet color="rgba(0, 0, 0, .12)">
              <g-chart
                :type="chartType"
                :data="sjatpi"
                :options="chartOptions"
              />
            </v-sheet>
          </v-card-text>
        </v-card>
      </v-col>
    </v-row>
  </v-container>  
{% endblock subcontent %}

{% block script %}

<script src="{% static "vendor/lodash/lodash.js" %}"></script>
<script src="{% static "vendor/vue-google-charts/vue-google-charts.browser.js" %}"></script>
<script>
  const DashboardValueCard = {
    props: ['value', 'text'],
    template: `
      <v-col cols="12" md="4">
        <v-card
          class="mx-auto text-center"
          outlined>
          <v-card-text>
            <p class="font-weight-black headline">[[ value ]]</p>
            <p class="title mb-0">[[ text ]]</p>
          </v-card-text>
        </v-card>
      </v-col>
    `
  }

  new Vue({
    el: '#inspire',
    vuetify: new Vuetify(),

    data: () => ({
      drawer: null,
      subBreadcrumbs: [],
      chartData: [
        ['Year', 'Sales', 'Expenses', 'Profit'],
        ['2014', 1000, 400, 200],
        ['2015', 1170, 460, 250],
        ['2016', 660, 1120, 300],
        ['2017', 1030, 540, 350]
      ],
      chartOptions: {
        chart: {
          title: 'Company Performance',
          subtitle: 'Sales, Expenses, and Profit: 2014-2017',
        }
      },
      chartType: 'ColumnChart',
      dashboardItemsNumber: [],
      sjatpi: [["Industry","Successful jobs per industry"]],
    }),

    methods: {
      setDataChoices: function(sourceId, setDataVariable) {
        let data = document.getElementById(sourceId).value;
        this.$set(this, setDataVariable, JSON.parse(data));
      },
      transformSJTPI: function(sourceId='dataSuccessfulJobsAllTimePerIndustry') {
        let data = document.getElementById(sourceId).value;
        data = JSON.parse(data);

        // set value label
        this.sjatpi[0][1] = data.title;

        // transform data to be consumed by a graph
        data = _.map(data.value, (graph) => {
          // graph is the value attribute from django
          return [
            graph.job_candidate__job__client__industry,
            graph.value
          ]
        });

        this.sjatpi = this.sjatpi.concat(data);
        }
    },

    beforeMount(){
      this.transformSJTPI();
    },

    mounted() {
      this.updateBreadcrumbs();
      this.setDataChoices('dataDashboardItemsNumber', 'dashboardItemsNumber');
    },

    components: {
      'dashboard-value-card': DashboardValueCard
    }

  });
</script>  
{% endblock script %}